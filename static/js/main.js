// Generated by CoffeeScript 1.7.1
(function() {
  var delay, search;

  delay = function(time, fn) {
    return setTimeout(fn, time);
  };

  window.kizzDBJSONPHandler = function(db) {
    console.log('db is ready');
    return console.log(db);
  };

  search = function(keyword) {
    var baseURL;
    console.log('search', keyword);
    baseURL = $('[rel="kizz-base-url"]').attr('href');
    console.log(db);
    return $.get(db, function(posts) {
      var html, match;
      match = posts.filter(function(post) {
        return JSON.stringify(post).indexOf(keyword) > -1;
      });
      if (match.length > 0) {
        html = match.map(function(post) {
          return "<article>\n    <h1>\n        <a href=\"" + (baseURL + '/' + post.link) + "\">" + post.title + "</a>\n    </h1>\n    <div class=\"meta\">\n        <div class=\"key\">Update:</div>\n        <div class=\"value\">" + post.modificationTime + "</div>\n        <div class=\"key\">Tags:</div>\n        <div class=\"value\">\n            <ul>\n                " + (post.tags.map(function(tag) {
            return "<li class='tag'>" + tag + "</li>";
          }).join('')) + "\n            </ul>\n        </div>\n    </div>\n</article>";
        });
        return $('#main').html(html);
      } else {
        return $('#main').html('<div class="error">404 - Not Found</div>');
      }
    });
  };

  $('#search').on('input', function() {
    var keyword;
    keyword = $(this).val();
    return delay(1, function() {
      return search(keyword);
    });
  });

}).call(this);
